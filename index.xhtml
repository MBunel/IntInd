<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Exemple</title>


    <noscript>Your browser does not support JavaScript!</noscript>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
	  crossorigin=""/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
    </script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
	    crossorigin="">
    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
	  crossorigin="anonymous"/>
    <link rel="stylesheet" href="style.css"/>

  </head>

  <body>

    <!-- Barre de navigation -->
    <nav class="navbar navbar-fixed-top navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">

          <a class="navbar-brand"
	     href="#">Project name</a>
        </div>
        <div id="navbar"
	     class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active">
	      <a href="#">Home</a>
	    </li>
            <li>
	      <a href="#about">About</a>
	    </li>
            <li>
	      <a href="#contact">Contact</a>
	    </li>
	    <li>
	      <a href="#"
		 id="sidebar-toggle-btn">PP
	      </a>
	    </li>
          </ul>
        </div><!-- /.nav-collapse -->
      </div><!-- /.container -->
    </nav><!-- /.navbar -->

    <!-- Carte -->
    <div id="container">
      <div id="sidebar">
	<div class="sidebar-wrapper">
	  <div class="panel panel-default" id="features">

	    <div class="panel-heading">
              <h3 class="panel-title">Titre panneau
		<button type="button"
			class="btn btn-xs btn-default pull-right"
			id="sidebar-hide-btn">
		  <i class="fa fa-chevron-left"></i>
		</button>
	      </h3>
	    </div>

            <div class="sidebar-table">
              <table class="table table-hover" id="feature-list">
                <tbody class="list"></tbody>
              </table>
	    </div>


	  </div>
	</div>
      </div>

      <div id="mapid"></div>
    </div>

    <script>


     var map = L.map('mapid').setView([51.505, -0.09], 13);

     L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
       attribution: 'Map tiles',
       subdomains: 'abcd',
       minZoom: 1,
       maxZoom: 16,
       ext: 'png'
     }).addTo(map);


     var markersGroup = new L.featureGroup()
			     .addTo(map);

     function onMapClick(e) {
       "use strict";
       var newMarlef = new L.marker(e.latlng, {
	 // marker d√©placable
	 draggable: true
       })
       // Ajout au tableau
			    .on('add',
				function (e) {
				  var latLng = e.target.getLatLng(),
				      lat = latLng.lat.toFixed(2),
				      lon = latLng.lng.toFixed(2);
				  console.log(lat);
				  // TODO
				  markerSidebar();
				}
			    )
       // Suppression marker clic droit
			    .on('contextmenu',
				function () {
				  markersGroup.removeLayer(this);
				}
			    )
       // Changement type au clic
			    .on('click',
				function (e) {
				  console.log(e);
				  // TODO
				}
			    )
			    .addTo(markersGroup);
     }

     function markerList() {
       var allMarkersObjArray = [];//new Array();
       var allMarkersGeoJsonArray = [];//new Array();

       $.each(map._layers, function (ml) {
         //console.log(map._layers)
         if (map._layers[ml]._layers) {

	   $.each(this._layers, function () {
             allMarkersObjArray.push(this)
             allMarkersGeoJsonArray.push(JSON.stringify(this.toGeoJSON()))
	   })
	 }
       })

       console.log(allMarkersGeoJsonArray);
     }


     function onMarkerLeftClick(e) {
       /* var newPopup = new L.popup()
	  .setLatLng(e.latlng)
	  .setContent("Popup")
	  .openOn(map);
	*/
     }

     map.on('click', onMapClick);


     // Add marker
     function markerSidebar(a) {
       $("#feature-list tbody")
	 .html(a);
     }

     $("#sidebar-toggle-btn").click(function() {
       animateSidebar();
       return false;
     });

     $("#sidebar-hide-btn").click(function() {
       animateSidebar();
       return false;
     });

     function animateSidebar() {
       $("#sidebar").animate({
	 width: "toggle"
       }, 350, function() {
	 map.invalidateSize();
       });
     }
    </script>

  </body>
</html>
